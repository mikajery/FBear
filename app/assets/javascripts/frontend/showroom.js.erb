var Showroom = function(el) {
	var items    = function() { return el.find('.showroom-col') },
		controls = el.find('[data-showroom=control]'),
		step     = 0,
        oldStep  = 0,
		slider   = el.find('[data-showroom=slide]'),
        wrap  = function() { return $(el.find('[data-showroom=wrap]').get(0)) }
	;

    var stepWidth = function() {
        return items().first().width();
    };

	var total = function() {
        var t = items().size() - Math.floor(el.width()/stepWidth()) + 1;
        return t > 0 ? t : 0;
	};

	var check = function(step) {
		var _total = total();

		if (step < 0) step = 0;
		if (step > _total) step = _total;

		return step;
	};

	var updateSlider = function(instant) {
        toLeft = step * stepWidth()

        if (step != oldStep)
        {
            if (step == 0) toLeft = -60;

            if (step && toLeft || !step)
                slider[instant ? 'css' : 'animate']({
                    marginLeft: -1 * toLeft
                });
            oldStep = step;
            console.log('STEP!');
        }
	};

	var slide = function(toLeft) {
		step = check(toLeft ? step - 1 : step + 1);
		updateSlider();
	};

	var resize = function() {
        var int, width = 0;

        int = setInterval(function() {
            wrap().height(slider.height());


            if (wrap().height())
            {
                width = wrap().height()/ 2

                items().not('.promo').each(function() {
                    $(this).css({
                        'width': width
                    });

                    $(this).addClass('ready');
                });

                console.log('WIDTH!');

                clearInterval(int);
            }
        }, 50);

	};

    el.on( "swipeleft", slide());
    el.on( "swiperight", slide(true));

	controls.click(function() {
		slide($(this).data('showroom-control') == 'right');
	});

	$('body')
		.on('resize:height', function() {
			resize();
			updateSlider(true);
		})
		.on('resize:width', function() {
			resize();
			updateSlider(true);
		});

	resize();

    this.refresh = function() {
        resize();
    };

    this.setStep = function(i) {
        step = i;
        updateSlider(true);
    }

    el.data('showroom', this);
    controls.css({
        'visibility': ''
    })

};