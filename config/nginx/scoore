upstream scoore_server {
	server unix:/var/sockets/scoore.production.sock fail_timeout=0; # Местоположение сокета должно совпадать с настройками файла config/unicorn.rb от корня вашего приложения.
}

server {
	listen www.scoore.ru:80; # Опять же, если на одном и том же ip находится несколько серверов, то эта строка будет выглядеть как-то так myapp.mydomain.ru:80
	client_max_body_size 1G; # Максимальный размер тела запроса (а простым языком - ограничение на размер заливаемого на сервер файла).
	server_name scoore.ru; # Имя сервера
	keepalive_timeout 5;
	root /var/www/scoore/production/current/public; # Эта строка всегда должна указывать в директорию public Rails приложения. А current там потому что деплой происходит через Capistrano

	try_files $uri/index.html $uri.html $uri @scoore; # Имя переменной не важно - главное, чтобы в блоке location ниже было аналогичное

	location @scoore {
		proxy_pass http://scoore_server; # Часть после http:// должна полностью соответствовать имени в блоке upstream выше.
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header Host $http_host;
		proxy_redirect off;
	}

	error_page 500 502 503 504 /500.html;
	location = /500.html {
		root /var/www/scoore/production/current/public;
	}
}
